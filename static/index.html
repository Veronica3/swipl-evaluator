<!DOCTYPE html>
<html>
<head>
<title>SWI Prolog</title>
<style type="text/css">
#loggingwindow {
  white-space: pre;
  font-family: monospace;
  max-width: 40em;
  min-width: 5em;
}
.error {
  color: red;
}
iframe {
  width: 100%;
  height: 25em;
}
textarea { margin: 1em; }
</style>
<meta charset="utf-8">
<script type="text/javascript" src="jquery-1.8.1.js"></script>
<script type="text/javascript" src="spin.js"></script>
<script type="text/javascript" src="jquery.json-2.3.js"></script>
<script type="text/javascript">
$(function() {

(function($) {
	$.fn.spin = function(opts, color) {
		var presets = {
			"tiny": { lines: 8, length: 2, width: 2, radius: 3 },
			"small": { lines: 8, length: 4, width: 3, radius: 5 },
			"large": { lines: 10, length: 8, width: 4, radius: 8 }
		};
		if (Spinner) {
			return this.each(function() {
				var $this = $(this),
					data = $this.data();

				if (data.spinner) {
					data.spinner.stop();
					delete data.spinner;
				}
				if (opts !== false) {
					if (typeof opts === "string") {
						if (opts in presets) {
							opts = presets[opts];
						} else {
							opts = {};
						}
						if (color) {
							opts.color = color;
						}
					}
					data.spinner = new Spinner($.extend({color: $this.css('color')}, opts)).spin(this);
				}
			});
		} else {
			throw "Spinner class not available.";
		}
	};
})(jQuery);

$.postJSON = function(url, data, callback) {
    $.ajaxSetup({ scriptCharset:"utf-8", 
                    contentType:"application/json; charset=utf-8" });
    $.post(url, $.toJSON(data), callback, "json");
}

$("#loggingwindow").ajaxError(function(e, jqxhr, settings, exception) {
    $(this).addClass("error");
    //$(this).text( exception.name + ": " + exception.message );
    $(this).text( exception.toString() );
    $(this).append($("<br>"));
    var ifrm = $("<iframe>");
    $(this).append(ifrm);
    console.log(ct);
    var ct = jqxhr.getResponseHeader("Content-Type")
    ifrm.get()[0].src = "data:" + ct + ";base64," + window.btoa(jqxhr.responseText);
    window.responseText = jqxhr.responseText;
    $(this).spin(false);
    throw exception;
});

window.run_swipl = function(clauses, queries) {
	$("#loggingwindow").spin();
	$.postJSON("/run_swipl",{"clauses": clauses, "queries": queries}, function (data) {
		if (data["status"] == "ok") {
			$("#loggingwindow").removeClass("error");
			$("#loggingwindow").text(data["data"]);
		} else {
			$("#loggingwindow").addClass("error");
			$("#loggingwindow").text(data["errormsg"]);
		}
		$("#loggingwindow").spin(false);
	});
}

window.submit = function() {
	run_swipl($("#clauses").val(), $("#queries").val().split("\n").filter(function(a) {return a.trim() !== "";}));
};

});
</script>
</head>
<body>
<h1>SWI Prolog</h1>
<div id="form">
<div style="float:left">
<label for="clauses">Clauses:<br></label>
<textarea rows=10 cols=50 id="clauses">baum(eich).</textarea>
</div>
<div>
<label for="queries">Queries:<br></label>
<textarea rows=10 cols=50 id="queries">baum(X).</textarea>
</div>
<input type="submit" onclick="submit();">
</div>
<div>Prolog output:</div>
<div id="loggingwindow"></div>
</body>
</html>

